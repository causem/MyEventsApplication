<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Create Event</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap z CDN -->
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css}" rel="stylesheet"/>
</head>
<body class="container py-4">

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Create Event</h2>
    <a class="btn btn-outline-secondary" th:href="@{/events}">Back to list</a>
</div>

<form th:action="@{/events}" th:object="${eventForm}" method="post" novalidate class="needs-validation">

    <!-- Name -->
    <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text" class="form-control" th:field="*{name}" placeholder="Event name">
        <div class="text-danger small" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Error</div>
    </div>

    <!-- Description -->
    <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea class="form-control" rows="3" th:field="*{description}" placeholder="Short description"></textarea>
        <div class="text-danger small" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">Error</div>
    </div>

    <!-- Date -->
    <div class="mb-3">
        <label class="form-label">Date & time</label>
        <input type="datetime-local" class="form-control" th:field="*{date}">
        <div class="text-danger small" th:if="${#fields.hasErrors('date')}" th:errors="*{date}">Error</div>
    </div>

    <!-- Capacity -->
    <div class="mb-3">
        <label class="form-label">Capacity</label>
        <input type="number" min="1" class="form-control" th:field="*{capacity}">
        <div class="text-danger small" th:if="${#fields.hasErrors('capacity')}" th:errors="*{capacity}">Error</div>
    </div>

    <!-- Location mode switch -->
    <div class="mb-3">
        <label class="form-label d-block">Location</label>

        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="locationMode" id="locExisting" value="existing" checked>
            <label class="form-check-label" for="locExisting">Choose existing</label>
        </div>

        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="locationMode" id="locNew" value="new">
            <label class="form-check-label" for="locNew">Add new</label>
        </div>
    </div>

    <!-- Existing location select -->
    <div id="existingLocationBox" class="mb-3">
        <label class="form-label">Existing location</label>
        <select class="form-select" th:field="*{locationId}">
            <option th:value="${null}">-- select location --</option>
            <option th:each="l : ${locations}"
                    th:value="${l.id}"
                    th:text="${l.name + ' (' + l.city + ')'}">
                Hala (Warszawa)
            </option>
        </select>
        <div class="text-danger small" th:if="${#fields.hasErrors('locationId')}" th:errors="*{locationId}">Error</div>
    </div>

    <!-- New location fields -->
    <div id="newLocationBox" class="mb-3" style="display:none;">
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Location name</label>
                <input type="text" class="form-control" th:field="*{location.name}" placeholder="e.g. Hala Expo">
                <div class="text-danger small" th:if="${#fields.hasErrors('location.name')}" th:errors="*{location.name}">Error</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">City</label>
                <input type="text" class="form-control" th:field="*{location.city}" placeholder="e.g. Warszawa">
                <div class="text-danger small" th:if="${#fields.hasErrors('location.city')}" th:errors="*{location.city}">Error</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Address</label>
                <input type="text" class="form-control" th:field="*{location.address}" placeholder="e.g. PrzykÅ‚adowa 1">
                <div class="text-danger small" th:if="${#fields.hasErrors('location.address')}" th:errors="*{location.address}">Error</div>
            </div>
        </div>
    </div>

    <!-- Global XOR rule feedback -->
    <div class="text-danger small mb-2" th:if="${#fields.hasErrors('location') or #fields.hasErrors('locationId')}">
        Please select an existing location or enter a new one.
    </div>

    <button class="btn btn-success">Create</button>
</form>

<!-- Bootstrap bundle z CDN -->
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js}"></script>
<script>
    const existingBox = document.getElementById('existingLocationBox');
    const newBox = document.getElementById('newLocationBox');
    const rExisting = document.getElementById('locExisting');
    const rNew = document.getElementById('locNew');

    function toggleBoxes() {
      const useExisting = rExisting.checked;
      existingBox.style.display = useExisting ? 'block' : 'none';
      newBox.style.display = useExisting ? 'none' : 'block';

      if (useExisting) {
        newBox.querySelectorAll('input').forEach(i => i.value = '');
      } else {
        const sel = existingBox.querySelector('select');
        if (sel) sel.value = '';
      }
    }

    rExisting.addEventListener('change', toggleBoxes);
    rNew.addEventListener('change', toggleBoxes);
    toggleBoxes();
</script>
</body>
</html>
